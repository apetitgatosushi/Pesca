<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Roleta da Sorte ‚Äî Apetit Gat√¥ Sushi</title>
<link rel="icon" href="logo.png" />
<style>
  :root{
    --bg:#070707;
    --panel:#0f0f0f;
    --accent:#ffcf33; /* amarelo */
    --muted:#bdbdbd;
    --glass: rgba(255,255,255,0.03);
    --radius:14px;
    --shadow: 0 8px 24px rgba(0,0,0,0.6);
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  body{
    background:
      radial-gradient(1200px 600px at 10% 10%, rgba(255,207,51,0.04), transparent 10%),
      radial-gradient(900px 400px at 90% 90%, rgba(255,207,51,0.03), transparent 10%),
      var(--bg);
    color:#fff;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px;
  }

  .container{
    width:100%;
    max-width:980px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
    border-radius:18px;
    padding:28px;
    box-shadow: var(--shadow);
    display:grid;
    grid-template-columns: 1fr 420px;
    gap:20px;
    align-items:center;
  }

  /* LEFT - info */
  .info{
    padding:18px 22px;
  }
  .brand{
    display:flex;
    gap:14px;
    align-items:center;
  }
  .brand img{
    width:72px;
    height:72px;
    object-fit:contain;
    border-radius:12px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    padding:8px;
  }
  .brand h1{
    margin:0;
    font-size:20px;
    letter-spacing:0.6px;
    color:var(--accent);
  }
  .brand p{margin:2px 0 0;font-size:13px;color:var(--muted);}

  .description{
    margin-top:18px;
    font-size:15px;
    color:#e9e9e9;
    line-height:1.45;
  }

  .rules{
    margin-top:18px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
  }
  .badge{
    background:var(--glass);
    border:1px solid rgba(255,255,255,0.03);
    padding:8px 12px;
    border-radius:999px;
    color:var(--muted);
    font-size:13px;
    display:inline-flex;
    gap:8px;
    align-items:center;
  }

  /* RIGHT - wheel */
  .game{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:12px;
    padding:16px;
    background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
    border-radius:12px;
  }

  .wheel-wrap{
    position:relative;
    width:360px;
    height:360px;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  canvas#wheel{
    width:360px;
    height:360px;
    border-radius:50%;
    box-shadow: 0 12px 30px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    background:transparent;
  }

  .pointer{
    position:absolute;
    top:-6px;
    width:12px;
    height:40px;
    background:var(--accent);
    transform:translateY(-50%) rotate(45deg);
    right:calc(50% - 6px);
    border-radius:4px;
    box-shadow:0 6px 16px rgba(255,207,51,0.12);
  }

  .spin-btn{
    background:linear-gradient(90deg,var(--accent), #f7b500);
    color:#111;
    border:none;
    padding:12px 18px;
    font-weight:700;
    border-radius:12px;
    cursor:pointer;
    box-shadow: 0 8px 18px rgba(0,0,0,0.45);
    transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
    font-size:16px;
    margin-top:8px;
  }
  .spin-btn:active{ transform:translateY(2px) scale(.995); }
  .spin-btn[disabled]{ opacity:.45; cursor:not-allowed; transform:none; }

  .status{
    margin-top:6px;
    font-size:13px;
    color:var(--muted);
  }

  /* result modal */
  .modal-backdrop{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.6);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:2000;
  }
  .modal{
    width:min(520px,94%);
    background:linear-gradient(180deg,#0c0c0c,#0b0b0b);
    border-radius:14px;
    padding:20px;
    text-align:center;
    box-shadow:var(--shadow);
    border:1px solid rgba(255,255,255,0.03);
  }
  .modal h2{ margin:0;color:var(--accent); font-size:22px; }
  .modal p{ color:#e6e6e6; margin:12px 0 18px; font-size:16px; }
  .modal .cta{
    display:flex;
    gap:10px;
    justify-content:center;
  }
  .btn-secondary{
    background:transparent;
    border:1px solid rgba(255,255,255,0.06);
    color:var(--muted);
    padding:10px 14px;
    border-radius:10px;
    cursor:pointer;
  }
  .btn-primary{
    background:var(--accent);
    border:none;
    padding:10px 14px;
    border-radius:10px;
    cursor:pointer;
    font-weight:700;
    color:#111;
  }

  /* small foot */
  .footer{
    margin-top:18px;
    font-size:13px;
    color:var(--muted);
  }

  /* confetti pieces (will be injected) */
  .confetti-piece{ position:fixed; z-index:3000; pointer-events:none; }

  /* responsive */
  @media(max-width:900px){
    .container{grid-template-columns:1fr; padding:18px;}
    .wheel-wrap{width:300px;height:300px}
    canvas#wheel{width:300px;height:300px}
  }
</style>
</head>
<body>
  <div class="container" role="application" aria-label="Roleta da Sorte Apetit Gat√¥ Sushi">
    <div class="info">
      <div class="brand">
        <img src="logo.png" alt="Apetit Gat√¥ Sushi logo (substitua por logo.png)" />
        <div>
          <h1>Apetit Gat√¥ Sushi ‚Äî Roleta da Sorte</h1>
          <p class="muted">Ganhe pr√™mios na sua pr√≥xima compra. 1 jogo por dia.</p>
        </div>
      </div>

      <div class="description">
        Gire a roleta ap√≥s sua compra (ou como cortesia da casa) e descubra seu pr√™mio. Cada fatia foi pensada para dar alegria ‚Äî desde um refrigerante at√© um meio uramaki. Jogue com carinho üç£
      </div>

      <div class="rules">
        <div class="badge">üéüÔ∏è 1 giro por dia</div>
        <div class="badge">üîí Seguro: sem cobran√ßa</div>
        <div class="badge">üì± Funciona no celular</div>
      </div>

      <div class="footer">Dica: permiss√µes de notifica√ß√£o n√£o s√£o necess√°rias. Tem d√∫vidas? Fala com a Regi no delivery üòâ</div>
    </div>

    <div class="game">
      <div class="wheel-wrap" aria-hidden="true">
        <canvas id="wheel" width="720" height="720"></canvas>
        <div class="pointer" aria-hidden="true"></div>
      </div>

      <button id="spinBtn" class="spin-btn">Girar a Roleta</button>
      <div id="status" class="status">Rodadas restantes hoje: <span id="remaining">1</span></div>
    </div>
  </div>

  <!-- Modal -->
  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document">
      <h2 id="modalTitle">üéâ Parab√©ns!</h2>
      <p id="modalMsg">Voc√™ ganhou: <strong id="prizeText"></strong></p>
      <div class="cta">
        <button id="closeModal" class="btn-secondary">Fechar</button>
        <button id="claimBtn" class="btn-primary">Como resgatar</button>
      </div>
    </div>
  </div>

<script>
/* ==========================
   Configura√ß√µes e pr√™mios
   ========================== */
const PRIZES = [
  "Coca Lata Caf√©",
  "Meio Uramaki",
  "Meio Hossomaki",
  "Suco Kappo",
  "10% de desconto",
  "Surpresa"
];

// Quantas rodadas permitir por dia (padr√£o 1)
const SPINS_PER_DAY = 1;

// Nome da chave do localStorage (n√£o mude se testar)
const STORAGE_KEY = "apetit_roleta_spins";

/* ==========================
   DOM & Canvas setup
   ========================== */
const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d', { alpha: true });
const dpr = window.devicePixelRatio || 1;
const size = Math.min(window.innerWidth * 0.45, 360);
canvas.width = 720; // high-res for crispness (CSS scales)
canvas.height = 720;
const cx = canvas.width/2;
const cy = canvas.height/2;
const radius = Math.min(cx, cy) - 12;

const arc = (2 * Math.PI) / PRIZES.length;

// colors
const bgColor = "#0b0b0b";
const colorA = "#ffcf33"; // amarelo
const colorB = "#222";

// state
let angle = 0; // radians
let isSpinning = false;

// UI elements
const spinBtn = document.getElementById('spinBtn');
const remainingEl = document.getElementById('remaining');
const statusEl = document.getElementById('status');
const modal = document.getElementById('modalBackdrop');
const prizeText = document.getElementById('prizeText');
const closeModal = document.getElementById('closeModal');
const claimBtn = document.getElementById('claimBtn');

/* ==========================
   Draw wheel
   ========================== */
function drawWheel(currentAngle=0){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // outer glow
  ctx.save();
  ctx.beginPath();
  ctx.arc(cx,cy,radius+6,0,2*Math.PI);
  const g = ctx.createRadialGradient(cx,cy,radius*0.2,cx,cy,radius+8);
  g.addColorStop(0,"rgba(255,207,51,0.06)");
  g.addColorStop(1,"rgba(0,0,0,0)");
  ctx.fillStyle=g;
  ctx.fill();
  ctx.restore();

  // slices
  for(let i=0;i<PRIZES.length;i++){
    const start = currentAngle + i*arc;
    const end = start + arc;
    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.arc(cx,cy,radius,start,end);
    ctx.closePath();
    ctx.fillStyle = (i%2===0) ? colorA : colorB;
    ctx.fill();

    // slice label
    ctx.save();
    ctx.translate(cx,cy);
    const mid = start + arc/2;
    ctx.rotate(mid);
    ctx.textAlign="left";
    ctx.fillStyle = (i%2===0) ? "#111" : "#ffdf7a";
    ctx.font = "26px 'Segoe UI', Roboto, Arial";
    ctx.fillText(PRIZES[i], radius*0.18, 10);
    ctx.restore();
  }

  // center disc
  ctx.beginPath();
  ctx.arc(cx,cy,70,0,2*Math.PI);
  ctx.fillStyle = "#0b0b0b";
  ctx.fill();
  ctx.lineWidth = 6;
  ctx.strokeStyle = "rgba(255,255,255,0.03)";
  ctx.stroke();

  // center label
  ctx.fillStyle = "rgba(255,255,255,0.9)";
  ctx.font = "bold 20px 'Segoe UI', Roboto, Arial";
  ctx.textAlign="center";
  ctx.fillText("GIRAR", cx, cy+8);

  // pointer highlight (small triangle notch)
  // (pointer is CSS element on top)
}

/* ==========================
   Easing & spin logic
   ========================== */
function easeOutCubic(t){ return 1 - Math.pow(1-t,3); }

function spinTo(prizeIndex){
  if(isSpinning) return;
  isSpinning = true;
  spinBtn.disabled = true;

  // target angle so prizeIndex lands under pointer (pointer at top -> angle = -pi/2)
  const randomOffset = (Math.random() * (arc*0.6) - (arc*0.3)); // small randomness inside slice
  const targetAngle = (2*Math.PI*6) + ( (PRIZES.length - prizeIndex) * arc ) - (Math.PI/2) + randomOffset;
  const duration = 4200 + Math.random()*800; // ms

  const start = performance.now();
  const startAngle = angle % (2*Math.PI);

  function frame(now){
    const elapsed = now - start;
    const t = Math.min(1, elapsed / duration);
    const eased = easeOutCubic(t);
    angle = startAngle + (targetAngle - startAngle) * eased;
    drawWheel(angle);

    if(t < 1){
      requestAnimationFrame(frame);
    } else {
      isSpinning = false;
      showResult(prizeIndex);
      markSpinUsed();
      updateRemainingUI();
      spinBtn.disabled = false;
    }
  }
  requestAnimationFrame(frame);
}

/* ==========================
   Choose prize & start spin
   ========================== */
function randomPrizeIndex(){
  // You can weight prizes here if desired
  return Math.floor(Math.random() * PRIZES.length);
}

spinBtn.addEventListener('click',()=>{
  if(getRemainingSpins() <= 0){ 
    alert("Voc√™ j√° usou sua rodada hoje. Volte amanh√£! üç£"); 
    return;
  }
  const idx = randomPrizeIndex();
  spinTo(idx);
  playTickSound();
});

/* ==========================
   Modal + confetti
   ========================== */
function showResult(index){
  const prize = PRIZES[index];
  prizeText.textContent = prize;
  modal.style.display = "flex";
  modal.setAttribute('aria-hidden','false');
  // create confetti
  launchConfetti();
}

closeModal.addEventListener('click',()=>{
  modal.style.display='none';
  modal.setAttribute('aria-hidden','true');
});
claimBtn.addEventListener('click',()=>{
  modal.style.display='none';
  modal.setAttribute('aria-hidden','true');
  // show instructions - for now just alert; you can customize to show coupon code, etc.
  alert("Para resgatar seu pr√™mio, apresente este site ao atendimento ou use o c√≥digo SORTE" );
});

/* ==========================
   Confetti (vanilla)
   ========================== */
function launchConfetti(){
  const colors = ["#ffcf33","#ffd966","#ffd54f","#ffb84d","#fff3d1"];
  const count = 40;
  for(let i=0;i<count;i++){
    const el = document.createElement('div');
    el.className = 'confetti-piece';
    el.style.left = Math.random()*100 + 'vw';
    el.style.top = '-10vh';
    el.style.transform = `rotate(${Math.random()*360}deg)`;
    el.style.opacity = String(0.8 + Math.random()*0.2);
    el.style.fontSize = (10 + Math.random()*18) + 'px';
    el.style.zIndex = 3000;
    el.innerHTML = '‚ñ∞';
    el.style.color = colors[Math.floor(Math.random()*colors.length)];
    document.body.appendChild(el);

    const duration = 1800 + Math.random()*1800;
    el.animate([
      { transform: `translateY(0) rotate(${Math.random()*360}deg)`, opacity:1 },
      { transform: `translateY(${80 + Math.random()*100}vh) rotate(${Math.random()*720}deg)`, opacity:0.2 }
    ], {
      duration,
      easing: 'cubic-bezier(.2,.8,.2,1)'
    });
    setTimeout(()=> el.remove(), duration + 40);
  }
}

/* ==========================
   LocalStorage spins per day
   ========================== */
function getTodayKey(){
  const d = new Date();
  return d.getFullYear() + "-" + (d.getMonth()+1) + "-" + d.getDate();
}
function getStorage(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : {};
  }catch(e){ return {}; }
}
function saveStorage(obj){
  try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(obj)); }catch(e){}
}
function getRemainingSpins(){
  const st = getStorage();
  const today = getTodayKey();
  const used = (st[today] || 0);
  return Math.max(0, SPINS_PER_DAY - used);
}
function markSpinUsed(){
  const st = getStorage();
  const today = getTodayKey();
  st[today] = (st[today] || 0) + 1;
  saveStorage(st);
}

/* ==========================
   UI init
   ========================== */
function updateRemainingUI(){
  remainingEl.textContent = getRemainingSpins();
  if(getRemainingSpins() <= 0){
    spinBtn.disabled = true;
    spinBtn.textContent = "J√° jogou hoje";
  } else {
    spinBtn.disabled = false;
    spinBtn.textContent = "Girar a Roleta";
  }
}
drawWheel(angle);
updateRemainingUI();

/* ==========================
   Optional: tick sound while spinning
   ========================== */
let tickOscillator;
function playTickSound(){
  if(!window.AudioContext && !window.webkitAudioContext) return;
  try{
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    const ctxAudio = new AudioCtx();
    // quick simple beep sequence to simulate ticks
    let i=0; const interval = setInterval(()=>{
      if(isSpinning) {
        const o = ctxAudio.createOscillator();
        const g = ctxAudio.createGain();
        o.type="sine";
        o.frequency.value = 600 + Math.random()*200;
        g.gain.value = 0.02;
        o.connect(g); g.connect(ctxAudio.destination);
        o.start();
        setTimeout(()=>{ o.stop(); }, 80);
      } else {
        clearInterval(interval);
      }
      i++; if(i>60) clearInterval(interval);
    }, 90);
  }catch(e){}
}

/* ==========================
   handle resize
   ========================== */
window.addEventListener('resize', ()=>{
  drawWheel(angle);
});

/* ==========================
   Accessibility: keyboard
   ========================== */
document.addEventListener('keydown', (e)=>{
  if(e.key === " " || e.key === "Enter"){
    if(document.activeElement === spinBtn || document.activeElement === document.body){
      e.preventDefault();
      spinBtn.click();
    }
  }
});
</script>
</body>
</html>

